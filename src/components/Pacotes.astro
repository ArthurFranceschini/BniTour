---
import CataratasImg from '../assets/image/Cards/Brasil/Cataratas.jpg';
import { ChevronLeft, ChevronRight } from 'lucide-astro';
---

<section id='Pacotes' class="section-padding section-reveal">
  <div class="relative z-10 p-4 md:p-8">
    <div class="header-container mb-8">
      <h1 class='text-black title-reveal'>Lorem ipsum dolor sit amet, consectetur.</h1>
      
      <div class="carousel-controls">
        <button class="carousel-btn carousel-btn-prev" id="prevBtn" style="display: none;">
          <ChevronLeft size={20} />
        </button>
        <button class="carousel-btn carousel-btn-next" id="nextBtn">
          <ChevronRight size={20} />
        </button>
      </div>
    </div>
    
    <div class="carousel-container">
      <div class="carousel-wrapper">
        <div class="carousel-track" id="carousel-track">
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-blue">Puerto Iguazú - Argentina</div>
            <img src={CataratasImg.src} alt="Puerto Iguazú - Argentina">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Cataratas do Iguaçu</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={CataratasImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Lado Brasileiro</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-red">Ciudad del Este - Paraguai</div>
            <img src={CataratasImg.src} alt="Ciudad del Este - Paraguai">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Compras no Paraguai</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="image-container card-reveal">
            <div class="card-tag card-tag-blue">Puerto Iguazú - Argentina</div>
            <img src={CataratasImg.src} alt="Puerto Iguazú - Argentina">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Cataratas do Iguaçu</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={CataratasImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Lado Brasileiro</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-red">Ciudad del Este - Paraguai</div>
            <img src={CataratasImg.src} alt="Ciudad del Este - Paraguai">
            <div class="card-content">
              <div class="card-content-wrapper">
                <div class="card-text">
                  <h1 class="mb-2">Compras no Paraguai</h1>
                  <p>Lorem ipsum dolor sit amet, consectetur.</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('.section-reveal');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('section-reveal-active');
          
          setTimeout(() => {
            const titles = entry.target.querySelectorAll('.title-reveal');
            titles.forEach((title, index) => {
              setTimeout(() => {
                title.classList.add('is-visible');
              }, index * 200); 
            });
          }, 400);
          
          setTimeout(() => {
            const cards = entry.target.querySelectorAll('.card-reveal');
            cards.forEach((card, index) => {
              setTimeout(() => {
                card.classList.add('is-visible');
              }, index * 200);
            });
          }, 800);
          
          // Animar botões CTA
          setTimeout(() => {
            const ctaButtons = entry.target.querySelectorAll('.btn-cta');
            ctaButtons.forEach((button, index) => {
              setTimeout(() => {
                button.classList.add('is-revealed');
              }, index * 200);
            });
          }, 1200);
        }
      });
    });

    sections.forEach(section => observer.observe(section));
    
    const track = document.getElementById('carousel-track') as HTMLElement;
    const prevBtn = document.getElementById('prevBtn') as HTMLButtonElement;
    const nextBtn = document.getElementById('nextBtn') as HTMLButtonElement;
    const cards = document.querySelectorAll('.image-container') as NodeListOf<HTMLElement>;
    const carouselContainer = document.querySelector('.carousel-container') as HTMLElement;
    
    if (!track || !prevBtn || !nextBtn || !carouselContainer || cards.length === 0) {
      return;
    }
    
    let currentIndex = 0;
    let autoPlayInterval: ReturnType<typeof setInterval> | null = null;
    
    function getCardsToShow(): number {
      return window.innerWidth >= 1024 ? 3 : window.innerWidth >= 768 ? 2 : 1;
    }
    
    function getMaxIndex(): number {
      return Math.max(0, cards.length - getCardsToShow());
    }
    
    function updateCarousel(): void {
      const firstCard = cards[0];
      if (!firstCard) return;
      
      const cardWidth = firstCard.offsetWidth;
      const gap = 24;
      const translateX = -(currentIndex * (cardWidth + gap));
      track.style.transform = `translateX(${translateX}px)`;
      
      const maxIndex = getMaxIndex();
      
      if (currentIndex === 0) {
        prevBtn.style.display = 'none';
      } else {
        prevBtn.style.display = 'flex';
      }
      
      if (currentIndex >= maxIndex) {
        nextBtn.style.display = 'none';
      } else {
        nextBtn.style.display = 'flex';
      }
    }
    
    function goToSlide(index: number): void {
      const maxIndex = getMaxIndex();
      currentIndex = Math.max(0, Math.min(index, maxIndex));
      updateCarousel();
    }
    
    function nextSlide(): void {
      const maxIndex = getMaxIndex();
      if (currentIndex < maxIndex) {
        goToSlide(currentIndex + 1);
      } else {
        goToSlide(0);
      }
    }
    
    function startAutoPlay(): void {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
      }
      
      autoPlayInterval = setInterval(() => {
        nextSlide();
      }, 4000);
    }
    
    function stopAutoPlay(): void {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
        autoPlayInterval = null;
      }
    }
    
    function resetAutoPlay(): void {
      stopAutoPlay();
      startAutoPlay();
    }
    
    prevBtn.addEventListener('click', () => {
      goToSlide(currentIndex - 1);
      resetAutoPlay();
    });
    
    nextBtn.addEventListener('click', () => {
      goToSlide(currentIndex + 1);
      resetAutoPlay();
    });
    
    carouselContainer.addEventListener('mouseenter', () => {
      stopAutoPlay();
    });
    
    carouselContainer.addEventListener('mouseleave', () => {
      startAutoPlay();
    });
    
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        stopAutoPlay();
      } else {
        startAutoPlay();
      }
    });
    
    window.addEventListener('resize', () => {
      const maxIndex = getMaxIndex();
      
      if (currentIndex > maxIndex) {
        currentIndex = maxIndex;
      }
      
      updateCarousel();
      resetAutoPlay();
    });
    
    updateCarousel();
    startAutoPlay();
  });
</script>