---
import { ChevronRight, Menu, X } from 'lucide-astro';
import FlagBR from '../assets/Icons/flag-br.svg?raw';
import FlagEUA from '../assets/Icons/flag-usa.svg?raw';
import FlagESP from '../assets/Icons/flag-esp.svg?raw';
---

<header class="header-padding flex items-center header-fade-in relative w-full bg-white z-50 transition-colors duration-300">
    <div class="flex items-center justify-between w-full">
        
        <div class="flex-shrink-0 lg:hidden">
            <button id="mobile-menu-btn" class="mobile-menu-btn p-2 rounded-lg border border-black bg-white">
                <Menu size={20} class="menu-icon" />
                <X size={20} class="close-icon hidden" />
            </button>
        </div>

        <div class="hidden lg:flex flex-shrink-0">
            <a href='/' class="btn-nav border-1 border-black text-black header-btn">
                <span class="button-content-initial-text" data-translate="header.cta">Fale Conosco</span>
                <div class="btn-cta-icon-wrapper button-content-initial-icon bg-black">
                    <ChevronRight size={20} class="text-white" />
                </div>
            </a>
        </div>

        <div class="absolute left-1/2 transform -translate-x-1/2">
            <img src="/logoipsum-332.svg" alt="Logo" class="h-6 md:h-8">
        </div>
        
        <div class="hidden lg:flex items-center gap-4">
            <div class="flex gap-4 nav-links">
                <a href="/" class="nav-item hover:text-black" data-translate="header.home">Início</a>
                <a href="/" class="nav-item" data-translate="header.tours">Passeios</a>
                <a href="/" class="nav-item" data-translate="header.about">Sobre</a>
                <a href="/" class="nav-item" data-translate="header.testimonials">Depoimentos</a>
                <a href="/" class="nav-item" data-translate="header.blog">Blog</a>
            </div>
            
            <div class="language-switcher-container">
                <button id="language-dropdown-btn" class="language-btn">
                    <div id="current-flag" class="flag-icon" set:html={FlagBR}></div>
                    <span id="current-lang">PT</span>
                    <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12">
                        <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    </svg>
                </button>
                
                <div id="language-dropdown" class="language-dropdown hidden">
                    <button data-lang="pt" class="lang-option active">
                        <div class="flag-icon" set:html={FlagBR}></div>
                        <span>Português</span>
                    </button>
                    <button data-lang="en" class="lang-option">
                        <div class="flag-icon" set:html={FlagEUA}></div>
                        <span>English</span>
                    </button>
                    <button data-lang="es" class="lang-option">
                        <div class="flag-icon" set:html={FlagESP}></div>
                        <span>Español</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="flex lg:hidden language-switcher-container">
            <button id="mobile-language-dropdown-btn" class="language-btn">
                <div id="mobile-current-flag" class="flag-icon" set:html={FlagBR}></div>
                <span id="mobile-current-lang">PT</span>
                <svg class="dropdown-arrow" width="10" height="10" viewBox="0 0 12 12">
                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
            
            <div id="mobile-language-dropdown" class="language-dropdown hidden">
                <button data-lang="pt" class="mobile-lang-option active">
                    <div class="flag-icon" set:html={FlagBR}></div>
                    <span>Português</span>
                </button>
                <button data-lang="en" class="mobile-lang-option">
                    <div class="flag-icon" set:html={FlagEUA}></div>
                    <span>English</span>
                </button>
                <button data-lang="es" class="mobile-lang-option">
                    <div class="flag-icon" set:html={FlagESP}></div>
                    <span>Español</span>
                </button>
            </div>
        </div>
    </div>

    <div id="mobile-menu-overlay" class="mobile-menu-overlay">
        <div class="mobile-menu-content">
            <nav class="mobile-nav">
                <a href="/" class="mobile-nav-item" data-translate="header.home">Início</a>
                <a href="/" class="mobile-nav-item" data-translate="header.tours">Passeios</a>
                <a href="/" class="mobile-nav-item" data-translate="header.about">Sobre</a>
                <a href="/" class="mobile-nav-item" data-translate="header.testimonials">Depoimentos</a>
                <a href="/" class="mobile-nav-item" data-translate="header.blog">Blog</a>
            </nav>

            <div class="mobile-cta-container">
                <a href='/' class="btn-nav border-1 border-black text-black w-full justify-center mobile-cta-btn is-revealed">
                    <span class="button-content-initial-text mobile-cta-text" data-translate="header.cta">Fale Conosco</span>
                    <div class="btn-cta-icon-wrapper button-content-initial-icon bg-black mobile-cta-icon">
                        <ChevronRight size={18} class="text-white" />
                    </div>
                </a>
            </div>
        </div>
    </div>
</header>

<style>

    /* Só CSS mobile  */
    .mobile-menu-btn {
        transition: all 0.3s ease;
        position: relative;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .mobile-menu-btn:hover {
        background: #f9f9f9;
    }

    .mobile-menu-btn.active .menu-icon {
        display: none;
    }

    .mobile-menu-btn.active .close-icon {
        display: block;
    }

    /* Mobile Menu Overlay */
    .mobile-menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        z-index: 40;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .mobile-menu-overlay.active {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }

    .mobile-menu-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        background: white;
        padding: 80px 24px 24px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    .mobile-menu-overlay.active .mobile-menu-content {
        transform: translateX(0);
    }

    /* Mobile Navigation */
    .mobile-nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .mobile-nav-item {
        padding: 16px 0;
        font-size: 18px;
        font-weight: 500;
        color: #1f2937;
        text-decoration: none;
        border-bottom: 1px solid #f3f4f6;
        transition: color 0.2s ease;
        opacity: 0;
        transform: translateX(-20px);
    }

    .mobile-menu-overlay.active .mobile-nav-item {
        animation: slideInLeft 0.3s ease forwards;
    }

    .mobile-nav-item:hover {
        color: #374151;
    }

    .mobile-menu-overlay.active .mobile-nav-item:nth-child(1) { animation-delay: 0.1s; }
    .mobile-menu-overlay.active .mobile-nav-item:nth-child(2) { animation-delay: 0.15s; }
    .mobile-menu-overlay.active .mobile-nav-item:nth-child(3) { animation-delay: 0.2s; }
    .mobile-menu-overlay.active .mobile-nav-item:nth-child(4) { animation-delay: 0.25s; }
    .mobile-menu-overlay.active .mobile-nav-item:nth-child(5) { animation-delay: 0.3s; }

    @keyframes slideInLeft {
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .mobile-cta-container {
        margin-top: auto;
        opacity: 0;
        transform: translateY(20px);
    }

    .mobile-menu-overlay.active .mobile-cta-container {
        animation: slideInUp 0.3s ease forwards 0.4s;
    }

    @keyframes slideInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .mobile-cta-btn .mobile-cta-text {
        opacity: 1 !important;
        transform: translateX(0) !important;
        transition: none !important;
    }

    .mobile-cta-btn .mobile-cta-icon {
        opacity: 1 !important;
        transform: translateX(0) !important;
        transition: none !important;
    }

    .language-dropdown {
        position: absolute !important;
        top: calc(100% + 4px) !important;
        right: 0 !important;
        background: white !important;
        border: 1px solid #e5e5e5 !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
        min-width: 140px !important;
        z-index: 1000 !important;
        opacity: 1 !important;
        transform: translateY(0) !important;
        transition: all 0.2s ease !important;
        visibility: visible !important;
        display: block !important;
    }

    .language-dropdown.hidden {
        opacity: 0 !important;
        transform: translateY(-10px) !important;
        pointer-events: none !important;
        visibility: hidden !important;
    }

    .lang-option,
    .mobile-lang-option {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        width: 100% !important;
        padding: 10px 12px !important;
        border: none !important;
        background: none !important;
        cursor: pointer !important;
        transition: background 0.2s ease !important;
        font-size: 14px !important;
        text-align: left !important;
        color: #374151 !important;
    }

    .lang-option:hover,
    .mobile-lang-option:hover {
        background: #f5f5f5 !important;
    }

    .lang-option.active,
    .mobile-lang-option.active {
        background: #f0f0f0 !important;
        font-weight: 500 !important;
    }

    .lang-option:first-child,
    .mobile-lang-option:first-child {
        border-radius: 8px 8px 0 0 !important;
    }

    .lang-option:last-child,
    .mobile-lang-option:last-child {
        border-radius: 0 0 8px 8px !important;
    }

    @media (max-width: 768px) {
        .header-padding {
            padding-left: 16px;
            padding-right: 16px;
        }

        .language-btn {
            padding: 6px 8px;
            font-size: 12px;
            gap: 4px;
        }

        .flag-icon {
            width: 16px;
            height: 12px;
        }

        .language-dropdown {
            min-width: 120px !important;
        }

        .lang-option,
        .mobile-lang-option {
            padding: 8px 10px !important;
            font-size: 12px !important;
        }
    }

    body.menu-open {
        overflow: hidden;
    }
</style>

<script is:inline define:vars={{ FlagBR, FlagEUA, FlagESP }}>
    if (window.globalTranslator) {
        console.log('🔄 GlobalTranslator já existe, reutilizando...');
    } else {
        console.log('🚀 Criando novo GlobalTranslator...');
        
        const languages = {
            pt: { name: 'Português', flag: FlagBR, code: 'pt-BR' },
            en: { name: 'English', flag: FlagEUA, code: 'en-US' },
            es: { name: 'Español', flag: FlagESP, code: 'es-ES' }
        };

       const translations = {
    pt: {
        'header.cta': "Fale Conosco",
        'header.home': "Início",
        'header.tours': "Passeios",
        'header.about': "Sobre",
        'header.testimonials': "Depoimentos",
        'header.blog': "Blog",
        'hero.cta.discover': "Conheça mais destinos...",
        'hero.slide1.title': "Sua Viagem para Foz do Iguaçu.<br> Experiências Sob Medida, Memórias Para Sempre.",
        'hero.subtitle': "Esqueça o estresse. A BNI Tour transforma sua viagem em Foz do Iguaçu, Paraguai e Argentina em um roteiro premium, exclusivo e inesquecível. Seu desejo é nosso guia...",
        'hero.cta.plan': "Planeje Sua Viagem Agora!",
        'hero.cta.tours': "Passeios",
        'hero.slide2.title': "Aventura nas Cataratas.<br> Emoções Que Marcam.",
        'hero.slide2.subtitle': "Explore a grandiosidade das Cataratas do Iguaçu, vivendo momentos de pura adrenalina e beleza natural. Sua jornada começa aqui!",
        'hero.slide3.title': "Cultura e Compras no Paraguai.<br> Diversão Sem Limites.",
        'hero.slide3.subtitle': "Descubra a efervescência cultural e as melhores oportunidades de compras em Ciudad del Este. Uma experiência única e inesquecível."
    },
    en: {
        'header.cta': "Contact Us",
        'header.home': "Home",
        'header.tours': "Tours",
        'header.about': "About",
        'header.testimonials': "Testimonials",
        'header.blog': "Blog",
        'hero.cta.discover': "Discover more destinations...",
        'hero.slide1.title': "Your Trip to Foz do Iguaçu.<br> Tailor-made Experiences, Memories Forever.",
        'hero.subtitle': "Forget the stress. BNI Tour transforms your trip to Foz do Iguaçu, Paraguay, and Argentina into a premium, exclusive, and unforgettable experience. Your desire is our guide...",
        'hero.cta.plan': "Plan Your Trip Now!",
        'hero.cta.tours': "Tours",
        'hero.slide2.title': "Adventure at the Falls.<br> Unforgettable Emotions.",
        'hero.slide2.subtitle': "Explore the grandeur of Iguazu Falls, experiencing moments of pure adrenaline and natural beauty. Your journey begins here!",
        'hero.slide3.title': "Culture and Shopping in Paraguay.<br> Unlimited Fun.",
        'hero.slide3.subtitle': "Discover the cultural effervescence and the best shopping opportunities in Ciudad del Este. A unique and unforgettable experience."
    },
    es: {
        'header.cta': "Contáctenos",
        'header.home': "Inicio",
        'header.tours': "Tours",
        'header.about': "Acerca de",
        'header.testimonials': "Testimonios",
        'header.blog': "Blog",
        'hero.cta.discover': "Descubre más destinos...",
        'hero.slide1.title': "Tu Viaje a Foz do Iguaçu.<br> Experiencias a Medida, Recuerdos para Siempre.",
        'hero.subtitle': "Olvídate del estrés. BNI Tour transforma tu viaje a Foz do Iguaçu, Paraguay y Argentina en un itinerario premium, exclusivo e inolvidable. Tu deseo es nuestra guía...",
        'hero.cta.plan': "¡Planifica Tu Viaje Ahora!",
        'hero.cta.tours': "Paseos",
        'hero.slide2.title': "Aventura en las Cataratas.<br> Emociones Que Marcan.",
        'hero.slide2.subtitle': "Explora la grandeza de las Cataratas del Iguazú, viviendo momentos de pura adrenalina y belleza natural. ¡Tu viaje comienza aquí!",
        'hero.slide3.title': "Cultura y Compras en Paraguay.<br> Diversión Sin Límites.",
        'hero.slide3.subtitle': "Descubre la efervescencia cultural y las mejores oportunidades de compras en Ciudad del Este. Una experiencia única e inolvidable."
    }
};

        class GlobalTranslator {
            constructor() {
                this.currentLanguage = 'pt';
                this.translations = translations;
            }

            init() {
                console.log('🚀 Inicializando tradutor...');
                this.loadSavedLanguage();
                
                setTimeout(() => {
                    this.translateAll();
                }, 100);
            }

            setLanguage(lang) {
                console.log('🌍 Mudando idioma para:', lang);
                
                if (this.translations[lang]) {
                    const oldLanguage = this.currentLanguage;
                    this.currentLanguage = lang;
                    
                    console.log('�� Executando tradução...');
                    this.translateAll();
                    
                    this.saveLanguage(lang);
                    this.dispatchLanguageChangeEvent(lang, oldLanguage);
                    
                    console.log('✅ Idioma alterado com sucesso!');
                } else {
                    console.error('❌ Idioma não encontrado:', lang);
                }
            }

            translateAll() {
                console.log('🔄 Traduzindo tudo para:', this.currentLanguage);
                
                const elements = document.querySelectorAll('[data-translate]');
                console.log('📝 Total de elementos encontrados:', elements.length);
                
                let translatedCount = 0;
                
                elements.forEach((element, index) => {
                    const key = element.getAttribute('data-translate');
                    
                    if (key) {
                        const translation = this.translations[this.currentLanguage]?.[key];
                        
                        if (translation) {
                            if (key.startsWith('header.')) {
                                element.textContent = translation;
                            } else {
                                element.innerHTML = translation;
                            }
                            translatedCount++;
                            console.log(`✅ [${index}] ${key} → "${translation}"`);
                        } else {
                            console.warn(`⚠️ Tradução não encontrada: ${key}`);
                        }
                    }
                });
                
                console.log(`🎯 Total traduzido: ${translatedCount}/${elements.length}`);
            }

            saveLanguage(lang) {
                localStorage.setItem('preferred-language', lang);
            }

            loadSavedLanguage() {
                const saved = localStorage.getItem('preferred-language');
                if (saved && this.translations[saved]) {
                    this.currentLanguage = saved;
                    console.log('📖 Idioma carregado:', saved);
                }
            }

            dispatchLanguageChangeEvent(newLang, oldLang) {
                console.log('📡 Disparando evento languageChanged');
                
                const event = new CustomEvent('languageChanged', {
                    detail: { 
                        newLanguage: newLang, 
                        oldLanguage: oldLang 
                    }
                });
                
                setTimeout(() => {
                    document.dispatchEvent(event);
                }, 50);
            }

            getCurrentLanguage() {
                return this.currentLanguage;
            }
        }

        window.globalTranslator = new GlobalTranslator();
        window.languages = languages;
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('🚀 Header carregado');
        
        window.globalTranslator.init();
        
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
        const mobileNavItems = document.querySelectorAll('.mobile-nav-item');

        if (mobileMenuBtn && mobileMenuOverlay) {
            mobileMenuBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isActive = mobileMenuOverlay.classList.contains('active');
                
                if (isActive) {
                    closeMobileMenu();
                } else {
                    openMobileMenu();
                }
            });

            mobileMenuOverlay.addEventListener('click', (e) => {
                if (e.target === mobileMenuOverlay) {
                    closeMobileMenu();
                }
            });

            mobileNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    closeMobileMenu();
                });
            });

            document.addEventListener('click', (e) => {
                if (!mobileMenuBtn.contains(e.target) && !mobileMenuOverlay.contains(e.target)) {
                    if (mobileMenuOverlay.classList.contains('active')) {
                        closeMobileMenu();
                    }
                }
            });
        }

        function openMobileMenu() {
            mobileMenuBtn.classList.add('active');
            mobileMenuOverlay.classList.add('active');
            document.body.classList.add('menu-open');
        }

        function closeMobileMenu() {
            mobileMenuBtn.classList.remove('active');
            mobileMenuOverlay.classList.remove('active');
            document.body.classList.remove('menu-open');
        }

        setTimeout(() => {
            updateDropdownDisplay(window.globalTranslator.getCurrentLanguage());
            updateMobileDropdownDisplay(window.globalTranslator.getCurrentLanguage());
        }, 200);

        const dropdownBtn = document.getElementById('language-dropdown-btn');
        const dropdown = document.getElementById('language-dropdown');
        const langOptions = document.querySelectorAll('.lang-option');

        if (dropdownBtn && dropdown) {
            dropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('hidden');
                
                const mobileDropdown = document.getElementById('mobile-language-dropdown');
                if (mobileDropdown) {
                    mobileDropdown.classList.add('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if (!dropdownBtn.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        }

        langOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = option.dataset.lang;
                
                if (lang) {
                    console.log('🎯 Clique no idioma desktop:', lang);
                    
                    window.globalTranslator.setLanguage(lang);
                    updateDropdownDisplay(lang);
                    updateMobileDropdownDisplay(lang);
                    updateActiveOption(lang);
                    updateMobileActiveOption(lang);
                    
                    dropdown.classList.add('hidden');
                }
            });
        });

        const mobileDropdownBtn = document.getElementById('mobile-language-dropdown-btn');
        const mobileDropdown = document.getElementById('mobile-language-dropdown');
        const mobileLangOptions = document.querySelectorAll('.mobile-lang-option');

        if (mobileDropdownBtn && mobileDropdown) {
            mobileDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                mobileDropdown.classList.toggle('hidden');
                
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if (!mobileDropdownBtn.contains(e.target) && !mobileDropdown.contains(e.target)) {
                    mobileDropdown.classList.add('hidden');
                }
            });
        }

        mobileLangOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();
                const lang = option.dataset.lang;
                
                if (lang) {
                    console.log('🎯 Clique no idioma mobile:', lang);
                    
                    window.globalTranslator.setLanguage(lang);
                    updateDropdownDisplay(lang);
                    updateMobileDropdownDisplay(lang);
                    updateActiveOption(lang);
                    updateMobileActiveOption(lang);
                    
                    mobileDropdown.classList.add('hidden');
                }
            });
        });

        const header = document.querySelector('.header-fade-in');
        if (header) {
            setTimeout(() => header.classList.add('is-visible'), 200);
        }

        const navItems = document.querySelectorAll('.nav-item');
        setTimeout(() => {
            navItems.forEach((item, index) => {
                setTimeout(() => item.classList.add('is-revealed'), index * 100);
            });
        }, 600);

        const headerBtns = document.querySelectorAll('.header-btn');
        setTimeout(() => {
            headerBtns.forEach((btn, index) => {
                setTimeout(() => btn.classList.add('is-revealed'), index * 200);
            });
        }, 1000);

        const langSwitchers = document.querySelectorAll('.language-switcher-container');
        setTimeout(() => {
            langSwitchers.forEach((switcher, index) => {
                setTimeout(() => switcher.classList.add('is-revealed'), 800 + (index * 100));
            });
        }, 800);
    });

    function updateDropdownDisplay(lang) {
        const currentFlag = document.getElementById('current-flag');
        const currentLang = document.getElementById('current-lang');
        
        if (currentFlag && currentLang && window.languages[lang]) {
            currentFlag.innerHTML = window.languages[lang].flag;
            currentLang.textContent = lang.toUpperCase();
        }
    }

    function updateMobileDropdownDisplay(lang) {
        const mobileCurrentFlag = document.getElementById('mobile-current-flag');
        const mobileCurrentLang = document.getElementById('mobile-current-lang');
        
        if (mobileCurrentFlag && mobileCurrentLang && window.languages[lang]) {
            mobileCurrentFlag.innerHTML = window.languages[lang].flag;
            mobileCurrentLang.textContent = lang.toUpperCase();
        }
    }

    function updateActiveOption(lang) {
        document.querySelectorAll('.lang-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === lang) {
                option.classList.add('active');
            }
        });
    }

    function updateMobileActiveOption(lang) {
        document.querySelectorAll('.mobile-lang-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === lang) {
                option.classList.add('active');
            }
        });
    }
</script>