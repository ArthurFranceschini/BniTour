---
import CataratasImg from '../assets/image/Cards/Brasil/Cataratas.jpg';
import ParqueImg from '../assets/image/Cards/Brasil/Parque das Aves.jpg';
import MacucoImg from '../assets/image/Cards/Brasil/Macuco.webp';
import ComprasImg from '../assets/image/Cards/Paraguai/Compras.jpg';
import CataratasArgImg from '../assets/image/Cards/Argentina/CataratasArg.webp';
import CityTourArgImg from '../assets/image/Cards/Argentina/CityTourArg.webp';
import KatamaramImg from   '../assets/image/Cards/Brasil/Katamaram 2.webp';
import SaltosDelMondayImg from   '../assets/image/Cards/Paraguai/SaltosDelMonday.webp';
import CityTourFozImg from '../assets/image/Cards/Brasil/Marco das Três Fonteiras.webp';

import { ChevronLeft, ChevronRight } from 'lucide-astro';

---
<section id='Packages' class="section-padding section-reveal">
  <div class="relative z-10 p-4 md:p-8">
    <div class="header-container flex justify-between items-center mb-4">
      <h1 class='text-black title-reveal w-1/4'>Descubra Nossas Experiências</h1>
      
      <div class="carousel-controls flex-shrink-0"> 
        <button class="carousel-btn carousel-btn-prev" id="prevBtn" style="display: none;">
          <ChevronLeft size={20} />
        </button>
        <button class="carousel-btn carousel-btn-next" id="nextBtn">
          <ChevronRight size={20} />
        </button>
      </div>
    </div>
    
    <h2 class='-mt-4 mb-8 w-1/2'>Viva o Melhor de Foz do Iguaçu e região com a BNI Tour...</h2>
    
    <div class="carousel-container">
      <div class="carousel-wrapper">
        <div class="carousel-track" id="carousel-track">
          
              <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={ParqueImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2 w-1/2">Joias Naturais</h1>
                  <p> Cataratas do Iguaçu e Parque das Aves.<br> A Força da Natureza...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-blue">Puerto Iguazú - Argentina</div>
            <img src={CityTourArgImg.src} alt="Puerto Iguazú - Argentina">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                <h1 class="mb-2 w-full">Cataratas Argentina</h1>
                  <p>Marcos das três fronteiras, jantar, <br> vinhoteca, cassino e muito mais...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>

                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={MacucoImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2 w-fill whitespace-nowrap">Aventura e <br> Emoção</h1>
                  <p> Para os amantes da aventura. Que tal um passeio de barco nas Cataratas?</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-red">Ciudad del Este - Paraguai</div>
            <img src={ComprasImg.src} alt="Ciudad del Este - Paraguai">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2">Compras <br> e Cultura</h1>
                  <p>Explore e compre em Ciudad del Este. <br> Sem preocupações...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="image-container card-reveal">
            <div class="card-tag card-tag-blue">Puerto Iguazú - Argentina</div>
            <img src={CityTourArgImg.src} alt="Puerto Iguazú - Argentina">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                <h1 class="mb-2 w-full">CIty Tour Argentina</h1>
                  <p>Marcos das três fronteiras, jantar, <br> vinhoteca, cassino e muito mais...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>

                </a>
              </div>
            </div>
          </div>
          
  <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={KatamaramImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2 whitespace-nowrap">Cruzeiro ao <br> Pôr do Sol</h1>
                  <p>Katamarã:<br> Foz do Iguaçu Sob um Novo Olhar...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
          <div class="image-container card-reveal">
            <div class="card-tag card-tag-red">Ciudad del Este - Paraguai</div>
            <img src={SaltosDelMondayImg.src} alt="Ciudad del Este - Paraguai">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2">City Tour <br> Paraguai</h1>
                  <p>Lago de Lá Republica, Igreja San Lucas <br> Saltos Monday e muito mais...</p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>

          <div class="image-container card-reveal">
            <div class="card-tag card-tag-green">Foz do Iguaçu - Brasil</div>
            <img src={CityTourFozImg.src} alt="Foz do Iguaçu - Brasil">
            <div class="absolute inset-0" style="background: linear-gradient(90deg, rgba(0, 0, 0, 0.5), transparent);"></div>
            <div class="card-content relative z-10">
              <div class="card-content-wrapper">
                <div class="card-text">
                 <h1 class="mb-2 w-full">City Tour <br> <span class="whitespace-nowrap">Foz do Iguaçu</span></h1>
                  <p>Transfer, Wonder Park, Itaipu, <br> Marco das três fronteiras e muito mais... </p>
                </div>
                <a href='/' class="btn-cta text-white hover:bg-white/10">
                  <span class="button-content-initial-text">Ver Mais</span>
                  <div class="btn-cta-icon-wrapper button-content-initial-icon bg-white/20">
                    <ChevronRight size={20} color="white" />
                  </div>
                </a>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</section>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('.section-reveal');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('section-reveal-active');
          
          setTimeout(() => {
            const titles = entry.target.querySelectorAll('.title-reveal');
            titles.forEach((title, index) => {
              setTimeout(() => {
                title.classList.add('is-visible');
              }, index * 200); 
            });
          }, 400);
          
          setTimeout(() => {
            const cards = entry.target.querySelectorAll('.card-reveal');
            cards.forEach((card, index) => {
              setTimeout(() => {
                card.classList.add('is-visible');
              }, index * 200);
            });
          }, 800);
          
          setTimeout(() => {
            const ctaButtons = entry.target.querySelectorAll('.btn-cta');
            ctaButtons.forEach((button, index) => {
              setTimeout(() => {
                button.classList.add('is-revealed');
              }, index * 200);
            });
          }, 1200);
        }
      });
    });

    sections.forEach(section => observer.observe(section));
    
    const track = document.getElementById('carousel-track') as HTMLElement;
    const prevBtn = document.getElementById('prevBtn') as HTMLButtonElement;
    const nextBtn = document.getElementById('nextBtn') as HTMLButtonElement;
    const cards = document.querySelectorAll('.image-container') as NodeListOf<HTMLElement>;
    const carouselContainer = document.querySelector('.carousel-container') as HTMLElement;
    
    if (!track || !prevBtn || !nextBtn || !carouselContainer || cards.length === 0) {
      return;
    }
    
    let currentIndex = 0;
    let autoPlayInterval: ReturnType<typeof setInterval> | null = null;
    
    function getCardsToShow(): number {
      return window.innerWidth >= 1024 ? 3 : window.innerWidth >= 768 ? 2 : 1;
    }
    
    function getMaxIndex(): number {
      return Math.max(0, cards.length - getCardsToShow());
    }
    
    function updateCarousel(): void {
      const firstCard = cards[0];
      if (!firstCard) return;
      
      const cardWidth = firstCard.offsetWidth;
      const gap = 24;
      const translateX = -(currentIndex * (cardWidth + gap));
      track.style.transform = `translateX(${translateX}px)`;
      
      const maxIndex = getMaxIndex();
      
      if (currentIndex === 0) {
        prevBtn.style.display = 'none';
      } else {
        prevBtn.style.display = 'flex';
      }
      
      if (currentIndex >= maxIndex) {
        nextBtn.style.display = 'none';
      } else {
        nextBtn.style.display = 'flex';
      }
    }
    
    function goToSlide(index: number): void {
      const maxIndex = getMaxIndex();
      currentIndex = Math.max(0, Math.min(index, maxIndex));
      updateCarousel();
    }
    
    function nextSlide(): void {
      const maxIndex = getMaxIndex();
      if (currentIndex < maxIndex) {
        goToSlide(currentIndex + 1);
      } else {
        goToSlide(0);
      }
    }
    
    function startAutoPlay(): void {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
      }
      
      autoPlayInterval = setInterval(() => {
        nextSlide();
      }, 4000);
    }
    
    function stopAutoPlay(): void {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
        autoPlayInterval = null;
      }
    }
    
    function resetAutoPlay(): void {
      stopAutoPlay();
      startAutoPlay();
    }
    
    prevBtn.addEventListener('click', () => {
      goToSlide(currentIndex - 1);
      resetAutoPlay();
    });
    
    nextBtn.addEventListener('click', () => {
      goToSlide(currentIndex + 1);
      resetAutoPlay();
    });
    
    carouselContainer.addEventListener('mouseenter', () => {
      stopAutoPlay();
    });
    
    carouselContainer.addEventListener('mouseleave', () => {
      startAutoPlay();
    });
    
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        stopAutoPlay();
      } else {
        startAutoPlay();
      }
    });
    
    window.addEventListener('resize', () => {
      const maxIndex = getMaxIndex();
      
      if (currentIndex > maxIndex) {
        currentIndex = maxIndex;
      }
      
      updateCarousel();
      resetAutoPlay();
    });
    
    updateCarousel();
    startAutoPlay();
  });
</script>